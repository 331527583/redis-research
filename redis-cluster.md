## Ping和Pong数据包内容 ##
Ping和Pong数据包由所有类型（比如发起投票的数据包）的通用的头部，还有一部分特别的内容是Gossip部分，同时这也是Ping和Pong数据包的特色，只有Ping和Pong包含Gossip。
通用的头部包含以下信息：

- Node ID,一个160bit的伪随机字符串，NodeID在集群创建时分配以后保持不变
- currentEpoch和configEpoch两个属性，这两个属性在redis cluster集群中的分布式算法中有很大的用场（细节在下一节介绍），slave节点的configEpoch是该slave和master最近一次通讯得到的master的configEpoch
- 节点的标志之类的属性，例如标志节点是主还是从的标记，和其他标记信息
- 节点负责的哈希槽的bitmap数组，如果节点是从，则是master的哈希槽
- 端口，发送者的tcp基准端口（这个端口是redis用来接收客户端请求，这个端口加上10000就是集群总线端口）
- 集群状态，发送者认为的集群状态，注意这里仅是发送者眼中的集群状态
- 如果发送者是从，则还有master的nodeID

Ping和Pong数据包包含gossip节段。Gossip节段发送者将自己知道的集群节点列表提供给接收节点。redis集群，并不是每次都将所有的其他已知节点列表都发送给接受者，而是随机选取部分节点。
对于每个添加到Gossip部分的节点会将以下信息报告给接受者：

- Node ID
- 节点的ip和端口
- 节点的flags，例如pfail

Gossip阶段允许接收节点获取其他节点的从发送者的角度看的状态信息（e.g pfail）。Gossip在集群中主要用来失败判定和节点发现。

## 失败判定 ##
Redis集群的失败判定是在一个主节点或者从节点被大多数节点认为是不可达的。判定的结果，或者晋升从成为主，或者如果晋升失败，整个集群处于失败状态从而不再接受客户端的任何请求。
每个节点都从其他已知节点获取一些列的标志位信息，其中有两个标志用作失败判定叫做pfail和fail。pfail意味着可能失败，它是一种不确认的失败类型。FAIL意味着节点是失败而且在一定时间内被大部分节点都认同的。无论是master还是slave都可以标记另外一个节点为PFAIL。


PFAIL标记：
一个节点标记另外一个节点为PFAIL当该节点超过node_timeout的时间不可达。

集群节点不可达的概念是指我们使用主动ping以后等待接受pong，如果等待的时间超过NODE_TIME.因此NODE_TIME必须大于网络的RTT这种机制才可行。